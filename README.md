# hsorter

`hsorter` — GTK3-приложение для ведения локальной библиотеки тайтлов (аниме/фильмы/сериалы) с хранением данных в SQLite.

## Статус проекта

Проект активно дорабатывается. Функциональность большая и частично экспериментальная, поэтому перед обновлениями рекомендуется делать резервные копии (в приложении есть встроенный модуль бэкапов).

## Запуск

```bash
python3 hsorter.py
```

## Импорт из Ant Movie Catalog (AMC)

```bash
python3 amc_import.py /path/to/export.xml /path/to/hsorter.sqlite
```

Опция `--dubs` записывает дубликаты в `dublicates.csv`.

## Основные возможности

- Трёхпанельный интерфейс: библиотека, карточка тайтла, медиафайлы.
- Расширенные статусы тайтлов (чеклисты), фильтрация и статистика по статусам.
- Авто-применение фильтров с debounce (без отдельной кнопки «Применить»).
- Теги в многострочном поле с нормализацией разделителей и сервисной валидацией.
- Синхронизация с AniDB:
  - загрузка полей тайтла;
  - мастер сравнения/копирования;
  - слияние тегов;
  - прогресс загрузки тегов персонажей.
- Работа с медиа:
  - drag-and-drop изображений/видео;
  - детальное окно видеофайла (миниатюры, дорожки, комментарии, изображения);
  - управление хардсабом и языком хардсаба.
- Экспорт в Emby:
  - отдельные настройки подключения;
  - проверка соединения;
  - экспорт тегов и AniDB ProviderId с прогрессом.
- Обслуживание:
  - пересчёт статистики;
  - валидация тегов;
  - создание недостающих миниатюр;
  - резервное копирование и восстановление.

## Резервные копии

В окне **Обслуживание → Резервное копирование**:

- **Создать резервную копию**: создаёт `.7z` архив с БД и кэшем в `.backups`.
- Имя архива: `hsorter_backup_YYYYMMDD_HHMM.7z`.
- Список копий показывает дату/время и размер.
- **Восстановить**: предлагает сначала сделать текущий бэкап, затем восстанавливает выбранный архив.

> Для бэкапа/восстановления нужна установленная утилита `7z` или `7zz`.

## Зависимости

Минимально:

- Python 3.10+
- `python3-gi` / GTK 3 (PyGObject)
- SQLite (встроенный модуль Python)

Для расширенных функций:

- `requests`
- `beautifulsoup4`
- `mediainfo` (CLI) и/или `pymediainfo`
- `ffmpeg`/`ffprobe` (миниатюры видео)
- `py7zr` (резервные копии в формате 7z)

## Данные

По умолчанию в каталоге проекта используются:

- `hsorter.sqlite` — база данных
- `.hsorter_cache/` — кэш изображений и миниатюр
- `.backups/` — архивы резервных копий

